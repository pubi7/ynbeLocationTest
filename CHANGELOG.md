# Өөрчлөлтийн Түүх (Changelog)

## 2024 - GPS Байршлын Хянах Системийн Шинэчлэлтүүд

### 1. GPS Байршлын Шинэчлэлтийн Цаг Харагдах
- **Тайлбар:** GPS-ийн байршлын сүүлийн шинэчлэлтийн цагийг газар дээр харуулах
- **Функц:**
  - `lastLocationUpdateTime` хувьсагч нэмсэн
  - `lastLocationUpdateTimeString` getter функц нэмсэн (жишээ: "5 секунд өмнө", "2 минут өмнө")
  - Газрын зураг дээр "Шинэчлэгдсэн: X секунд өмнө" гэж харагдана
- **Файл:** `lib/providers/location_provider.dart`, `lib/screens/settings/settings_screen.dart`

### 2. GPS Байршлыг 2 Секунд Тутамд Хадгалах
- **Тайлбар:** GPS-ийн байршлыг 2 секунд тутамд автоматаар хадгалах механизм нэмсэн
- **Функц:**
  - `Timer.periodic` ашиглан 2 секунд тутамд `_saveLocations()` дуудах
  - Position stream-ээс байршил шинэчлэгдэх бүрт хадгалагдана
  - 2 секунд тутамд хадгалалтыг баталгаажуулна
- **Файл:** `lib/providers/location_provider.dart`

### 3. 20 Метрийн Тойрог Хүрээ Газрын Зураг Дээр
- **Тайлбар:** Одоогийн GPS байршлын эргэн тойронд 20 метрийн радиус бүхий тойрог overlay харуулах
- **Функц:**
  - `_generateCirclePoints()` функц нэмсэн - тойргийн цэгүүдийг тооцоолох
  - `PolygonLayer` ашиглан тойрог зурна
  - Хөх өнгөтэй, ил тод хүрээ (20% opacity дүүргэлт, 80% opacity хүрээ)
  - Зөвхөн хянах идэвхтэй ба GPS байршил байх үед харуулагдана
- **Файл:** `lib/screens/settings/settings_screen.dart`

### 4. 20 Метрийн Хүрээ Доторх Хөдөлгөөнийг Хадгалахгүй Болгох
- **Тайлбар:** 20 метрийн хүрээ доторх хөдөлгөөнийг location history-д нэмэхгүй болгох
- **Функц:**
  - `_minDistanceToSave` тогтмол нэмсэн (20.0 метр)
  - `_shouldAddToHistory()` helper функц нэмсэн
    - Сүүлийн байршлаас зайг тооцоолно
    - 20 метрээс ойр байвал хадгалахгүй
    - Эхний байршлыг үргэлж хадгална
  - Бүх байршлын шинэчлэлтүүдэд шалгалт нэмсэн:
    - Position stream listener
    - startTracking() функц
    - updateCurrentLocation() функц
    - useFakeLocation() функц
- **Файл:** `lib/providers/location_provider.dart`

### 5. Одоогийн Байршлаас 20 Метрт Ойрхон Дэлгүүрүүдийг Зөвхөн Харуулах
- **Тайлбар:** Газрын зураг дээр одоогийн байршлаас 20 метрт доторх дэлгүүрүүдийг зөвхөн харуулах
- **Функц:**
  - `Geolocator.distanceBetween()` ашиглан зайг тооцоолно
  - `.where()` ашиглан 20 метрээс ойр дэлгүүрүүдийг шүүнэ
  - Marker дээр зайг метрөөр харуулна (жишээ: "15м")
  - Marker-ийн хэмжээг өргөтгөсөн (зайны мэдээлэлтэй)
- **Файл:** `lib/screens/settings/settings_screen.dart`

### 6. GPS Оффлайн Горимд Ажиллах Функц Сайжруулсан
- **Тайлбар:** GPS оффлайн байсан ч ажиллах боломжийг нэмэх
- **Функц:**
  - Location service идэвхгүй үед `getLastKnownPosition()` ашиглана
  - GPS амжилтгүй бол сүүлийн мэдэгдэх байршлыг ашиглана
  - Хэрэв сүүлийн байршил байхгүй бол SharedPreferences-д хадгалагдсан байршлыг ашиглана
  - Оффлайн горимд байгааг мэдэгдэлээр мэдээлнэ
- **Файл:** `lib/providers/location_provider.dart`

## Техник Мэдээлэл

### Ашигласан Package-ууд:
- `geolocator` - GPS байршлын мэдээлэл авах
- `latlong2` - Байршлын тооцоолол, тойргийн цэгүүдийг тооцоолох
- `flutter_map` - Газрын зураг харуулах
- `shared_preferences` - Байршлын түүхийг хадгалах

### Гол Өөрчлөлтүүд:
1. **LocationProvider класс:**
   - `_lastLocationUpdateTime` хувьсагч нэмсэн
   - `_minDistanceToSave` тогтмол нэмсэн
   - `_locationUpdateTimer` Timer нэмсэн
   - `_shouldAddToHistory()` функц нэмсэн
   - Бүх байршлын шинэчлэлтүүдэд шалгалт нэмсэн

2. **Settings Screen (_MapDialog):**
   - `_generateCirclePoints()` функц нэмсэн
   - 20 метрийн тойрог хүрээ нэмсэн (PolygonLayer)
   - Дэлгүүрүүдийн зайг тооцоолж шүүх функц нэмсэн
   - Marker дээр зайг харуулах функц нэмсэн
   - GPS шинэчлэлтийн цагийг газар дээр харуулах функц нэмсэн

### Ашиглалт:
- GPS хянахад одоогийн байршлын эргэн тойронд 20 метрийн тойрог хүрээ харагдана
- Зөвхөн 20 метрт доторх дэлгүүрүүдийг харуулна
- 20 метрээс хол байршлыг location history-д нэмнэ
- 2 секунд тутамд байршлыг хадгална
- GPS шинэчлэлтийн цагийг газар дээр харах боломжтой




